end on_nl on_ignored_nl it on_tstring_beg on_tstring_content on_tstring_end do on_ignored_nl mock on_lparen on_ivar on_rparen on_period check on_period once on_lbrace on_ignored_nl UNK # Show that we save options
on_ignored_nl expect on_lbrace on_ignored_nl on_const on_period receive! on_rbrace on_period to change on_lbrace agents on_lparen on_symbeg bob_rain_notifier_agent on_rparen on_period reload on_period # bob_weather_agent makes an event
on_rbrace on_period to change on_lbrace agents on_lparen on_symbeg bob_rain_notifier_agent on_rparen on_period reload on_period last_checked_event_id on_rbrace on_nl on_ignored_nl agent2 on_period check # event gets propagated
agent2 on_period check on_nl agent2 on_period check on_nl on_ignored_nl agents on_lparen on_symbeg bob_rain_notifier_agent on_rparen on_period sources on_op agent2 on_nl expect # This agent creates a few events before we link to it, but after our last check.
agents on_lparen on_symbeg bob_rain_notifier_agent on_rparen on_period sources on_op agent2 on_nl expect on_lparen agent2 on_period UNK on_period UNK on_period UNK on_rparen # Now we link to it.
on_rbrace on_period not_to change on_lbrace agents on_lparen on_symbeg bob_rain_notifier_agent on_rparen on_period reload on_period last_checked_event_id on_rbrace on_nl on_ignored_nl agent2 on_period check # but we don't receive those events because they're too old
agent2 on_period check on_nl on_ignored_nl expect on_lbrace on_ignored_nl on_const on_period receive! on_rbrace on_period to change on_lbrace agents on_lparen on_symbeg bob_rain_notifier_agent # Now a new event is created by agent2
on_rbrace on_period to change on_lbrace agents on_lparen on_symbeg bob_rain_notifier_agent on_rparen on_period reload on_period last_checked_event_id on_rbrace on_nl end on_nl on_ignored_nl it # and we receive it
end on_nl on_ignored_nl it on_tstring_beg on_tstring_content on_tstring_end do on_ignored_nl on_const on_period UNK on_nl sender on_op on_const on_op on_const on_period new #should be true without calling Agent.receive!
expect on_lparen slow_receiver on_period events on_period count on_rparen on_period to eq on_lparen on_int on_rparen on_nl on_const on_period receive! on_nl expect #we should get the quick one #but not the slow one
expect on_lparen im_receiver on_period events on_period count on_rparen on_period to eq on_lparen on_int on_rparen on_nl expect on_lparen slow_receiver on_period events #now we should have one in both
end on_nl on_ignored_nl it on_tstring_beg on_tstring_content on_tstring_end do on_ignored_nl agent on_op on_const on_op on_const on_period new on_lparen on_symbeg name on_op # Integer (ruby >=2.4) or Fixnum (ruby <2.4)
agent on_period keep_events_for on_op on_tstring_beg on_tstring_content on_tstring_end on_nl expect on_lparen agent on_period keep_events_for on_rparen on_period to eq on_lparen on_int on_rparen # Rails seems to call to_i on the input. This guards against future changes to that behavior.
end on_nl on_ignored_nl it on_tstring_beg on_tstring_content on_tstring_end do on_ignored_nl expect on_lbrace on_ignored_nl on_ivar on_period options on_lbracket on_symbeg UNK on_rbracket on_op # The larger time is to deal with daylight savings
