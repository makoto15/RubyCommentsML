value on_nl UNK UNK on_op UNK on_op value on_op on_const on_op on_lparen value on_op UNK on_lparen key on_comma on_const on_rparen # non-falsy value is an existing mapping, return it right away
UNK UNK on_op UNK on_op value on_op on_const on_op on_lparen value on_op UNK on_lparen key on_comma on_const on_rparen on_rparen on_nl # re-check is done with get_or_default(key, NULL) instead of a simple !key?(key) in order to avoid a race condition, whereby by the time the current thread gets to the key?(key) call # a key => value mapping might have already been created by a different thread (key?(key) would then return true, this elsif branch wouldn't be taken and an incorrent +nil+ value # would be returned) # note: nil == value check is not technically necessary
