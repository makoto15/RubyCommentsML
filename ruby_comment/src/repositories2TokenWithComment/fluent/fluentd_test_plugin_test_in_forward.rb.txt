on_ivar on_op nil on_nl end on_nl on_ignored_nl def UNK on_nl on_ivar on_period instance_shutdown if on_ivar on_nl end on_nl on_ignored_nl on_const # for testing responses after sending data
entries on_op on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_comma true on_comma on_lbrace on_tstring_beg on_tstring_content on_tstring_end on_op on_int on_rbrace on_rbracket on_op on_lbracket on_tstring_beg # These entries are skipped
send_data packer on_period write on_lparen on_lbracket tag on_comma _time on_comma record on_rbracket on_rparen on_period to_s on_rbrace on_nl end on_nl on_ignored_nl # Without ack, logs are sometimes not saved to logs during test.
on_rbrace on_nl end on_nl on_ignored_nl logs on_op d on_period instance on_period log on_period logs on_nl assert_equal on_int on_comma logs on_period #, try_to_receive_response: true
entries on_op on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_comma on_lbrace on_tstring_beg on_tstring_content on_tstring_end on_op on_int on_rbrace on_rbracket on_op on_lbracket time on_comma on_tstring_beg # These entries are skipped
entries on_op on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_comma on_lbrace on_tstring_beg on_tstring_content on_tstring_end on_op on_int on_rbrace on_rbracket on_op on_lbracket time on_comma on_tstring_beg # These entries are skipped
entries on_op on_tstring_beg on_tstring_end on_nl events on_period each do on_op _tag on_comma _time on_comma record on_op on_ignored_nl UNK on_op on_lbracket # create compressed entries
entries on_op on_tstring_beg on_tstring_end on_nl events on_period each do on_op _tag on_comma _time on_comma record on_op on_ignored_nl UNK on_op on_lbracket # create compressed entries
UNK on_lparen on_const on_op on_const on_rparen on_period new on_lparen entries on_comma nil on_comma on_int on_rparen on_nl on_ignored_nl d on_period run # check CompressedMessagePackEventStream is created
str on_op on_tstring_beg on_tstring_content on_tstring_end on_op on_int on_op on_int on_nl chunk on_op on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_comma on_lparen on_int on_op # generate over 16M chunk
emits on_op d on_period events on_nl assert_equal on_int on_comma emits on_period size on_nl assert emits on_period map on_lparen on_op on_symbeg # check emitted data
logs on_op d on_period instance on_period log on_period logs on_nl assert_equal on_int on_comma logs on_period select on_lbrace on_op line on_op # check log
str on_op on_tstring_beg on_tstring_content on_tstring_end on_op on_int on_op on_int on_nl chunk on_op on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_comma on_lparen on_int on_op # generate over 16M chunk
logs on_op d on_period instance on_period log on_period logs on_nl assert_equal on_int on_comma logs on_period select on_lbrace on_op line on_op # check log
str on_op on_tstring_beg on_tstring_content on_tstring_end on_op on_int on_op on_int on_nl chunk on_op on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_comma on_lparen on_int on_op # generate over 32M chunk
d on_period run on_lparen on_label false on_rparen do on_ignored_nl on_const on_op on_const on_period msgpack_unpacker on_period UNK on_lparen chunk on_rparen do # d.run => send_data
emits on_op d on_period events on_nl assert_equal on_int on_comma emits on_period size on_nl on_ignored_nl logs on_op d on_period instance on_period # check emitted data
logs on_op d on_period instance on_period log on_period logs on_nl assert_equal on_int on_comma logs on_period select on_lbrace on_op line on_op # check log
d on_period run on_lparen on_label false on_rparen do on_ignored_nl d on_period instance on_period send on_lparen on_symbeg on_message on_comma data on_comma # d.run => send_data
assert_equal on_int on_comma d on_period events on_period size on_nl on_ignored_nl logs on_op d on_period instance on_period log on_period logs on_nl # check emitted data
logs on_op d on_period instance on_period log on_period logs on_nl assert_equal on_int on_comma logs on_period select on_lbrace on_op line on_op # check log
data on_lparen on_label on_lbrace on_ignored_nl on_label on_const on_comma on_ignored_nl on_label on_lbrace on_ignored_nl on_label false on_nl on_rbrace on_nl on_rbrace on_comma on_ignored_nl # FIX: response is not pushed into @responses because IO.select has been blocked until InputForward shutdowns
on_rparen on_nl test on_tstring_beg on_tstring_content on_tstring_end do on_op data on_op on_ignored_nl config on_op data on_lbracket on_symbeg config on_rbracket on_nl options ### Auth is not supported with json # auth: { # config: CONFIG_AUTH, # options: { # auth: true # } # },
on_rparen on_nl test on_tstring_beg on_tstring_content on_tstring_end do on_op data on_op on_ignored_nl config on_op data on_lbracket on_symbeg config on_rbracket on_nl options ### Auth is not supported with json # auth: { # config: CONFIG_AUTH, # options: { # auth: true # } # },
def UNK on_lparen io on_comma UNK on_comma on_op UNK on_rparen on_ignored_nl res on_op on_tstring_beg on_tstring_end on_nl UNK on_op UNK on_nl # res # '' : socket is disconnected without any data # nil: socket read timeout
rescue on_const on_op on_const on_nl UNK UNK on_nl UNK if res on_op on_tstring_beg on_tstring_end on_nl rescue on_const on_comma on_const on_comma # timeout without no data arrival
rescue on_const on_comma on_const on_comma on_const on_op on_const on_nl end on_nl res on_nl end on_nl on_ignored_nl def UNK on_lparen io # if res is not empty, all data in socket buffer are read, so do not retry
end on_nl res on_nl end on_nl on_ignored_nl def UNK on_lparen io on_comma UNK on_op on_const on_comma UNK on_op on_const on_comma # socket disconnected
UNK on_op UNK on_lparen io on_comma UNK on_rparen on_lbrace on_op data on_op on_const on_period unpack on_lparen data on_rparen rescue nil # reading helo
UNK on_op on_const on_period unpack on_lparen UNK on_rparen on_nl raise on_tstring_beg on_tstring_content on_tstring_end unless UNK on_lbracket on_int on_rbracket on_op on_tstring_beg # ['HELO', options(hash)]
UNK on_op on_lbracket on_ignored_nl on_tstring_beg on_tstring_content on_tstring_end on_comma on_ignored_nl on_tstring_beg on_tstring_content on_tstring_end on_comma on_ignored_nl UNK on_comma on_ignored_nl on_const on_op on_const # sending ping
UNK on_op on_const on_op on_const on_period new on_period update on_lparen on_ivar on_lbracket on_tstring_beg on_tstring_content on_tstring_end on_rbracket on_rparen on_period update on_lparen # auth enabled -> value is auth salt
UNK on_op UNK on_lparen io on_comma UNK on_rparen on_lbrace on_op data on_op on_const on_period unpack on_lparen data on_rparen rescue nil # reading pong
pong on_op on_const on_period unpack on_lparen UNK on_rparen on_nl raise on_tstring_beg on_tstring_content on_tstring_end unless pong on_lbracket on_int on_rbracket on_op on_tstring_beg # ['PING', bool(auth_result), string(reason_if_failed), self_hostname, shared_key_digest]
true on_nl end on_nl on_ignored_nl def UNK on_nl on_const on_period new on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_const on_rparen on_nl end # authentication success
def send_data on_lparen data on_comma on_label false on_comma on_label on_int on_comma on_label false on_rparen on_ignored_nl io on_op UNK on_nl on_ignored_nl # Data ordering is not assured: # Records in different sockets are processed on different thread, so its scheduling make effect # on order of emitted records. # So, we MUST sort emitted records in different `send_data` before assertion.
end on_nl on_ignored_nl sub_test_case on_tstring_beg on_tstring_content on_tstring_end do on_ignored_nl data on_lparen on_ignored_nl on_label on_lbracket on_symbeg hostname on_comma on_symbeg address on_rbracket # SSL socket requires any writes to close sockets
end on_nl EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP EMP # TODO heartbeat
