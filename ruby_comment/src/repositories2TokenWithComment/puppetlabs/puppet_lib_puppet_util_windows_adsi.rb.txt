on_const on_op on_int on_nl on_const on_op on_int on_nl on_const on_op on_int on_nl on_const on_op on_int on_nl on_const on_op on_int on_nl # https://docs.microsoft.com/en-us/windows/win32/api/dsrole/ne-dsrole-dsrole_machine_role
on_const on_op on_int on_nl on_ignored_nl def UNK on_nl unless on_ivar on_nl max_length on_op on_const on_op on_int on_const on_op on_const on_period # taken from winbase.h
on_const on_op on_const on_period new on_lparen max_length on_op on_int on_rparen do on_op buffer on_op on_const on_op on_const on_period new on_lparen # NULL terminated
on_const on_op on_const on_period new on_lparen on_symbeg UNK on_comma on_int on_rparen do on_op buffer_size on_op on_ignored_nl buffer_size on_period UNK on_lparen # wide string
on_ignored_nl if on_const on_lparen buffer on_comma buffer_size on_rparen on_op on_const on_op on_const on_nl raise on_const on_op on_const on_op on_const on_op # length in TCHARs
def UNK on_lparen sid on_rparen on_ignored_nl return UNK on_lparen sid on_rparen if sid on_period UNK on_lparen on_const on_op on_const on_op # This method should *only* be used to generate WinNT://<SID> style monikers # used for IAdsGroup::Add / IAdsGroup::Remove. These URIs are not usable # to resolve an account with WIN32OLE.connect # Valid input is a SID::Principal, S-X-X style SID string or any valid # account name with or without domain prefix # @api private
def UNK on_lparen sid on_rparen on_ignored_nl raise on_const on_op on_const on_period new on_lparen _ on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_rparen # This method should *only* be used to generate WinNT://<SID> style monikers # used for IAdsGroup::Add / IAdsGroup::Remove. These URIs are not useable # to resolve an account with WIN32OLE.connect
UNK on_symbeg UNK on_nl UNK on_symbeg on_const on_comma on_ignored_nl on_lbracket on_symbeg UNK on_comma on_symbeg UNK on_rbracket on_comma on_symbeg UNK on_nl # https://msdn.microsoft.com/en-us/library/windows/desktop/ms724295(v=vs.85).aspx # BOOL WINAPI GetComputerName( # _Out_ LPTSTR lpBuffer, # _Inout_ LPDWORD lpnSize # );
class on_const on_nl UNK on_const on_nl on_ignored_nl class on_op self on_nl UNK on_symbeg UNK on_nl on_ignored_nl def UNK on_nl on_ivar # Common base class shared by the User and Group # classes below.
class on_op self on_nl UNK on_symbeg UNK on_nl on_ignored_nl def UNK on_nl on_ivar on_op on_lbracket on_ignored_nl on_const on_op on_const on_op # Define some useful class-level methods
UNK on_symbeg UNK on_nl on_ignored_nl def UNK on_nl on_ivar on_op on_lbracket on_ignored_nl on_const on_op on_const on_op on_const on_op on_const on_period # Is either 'user' or 'group'
on_const on_op on_const on_op on_const on_op on_const on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_period UNK on_comma on_ignored_nl on_const on_op # localized version of BUILTIN # for instance VORDEFINIERT on German Windows
on_const on_op on_const on_op on_const on_op on_const on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_period domain on_period UNK on_nl on_rbracket # localized version of NT AUTHORITY (can't use S-1-5) # for instance AUTORITE NT on French Windows
def UNK on_lparen UNK on_rparen on_ignored_nl sids on_op on_lbracket on_rbracket on_nl UNK on_period each do on_op UNK on_op on_ignored_nl sids # returns Puppet::Util::Windows::SID::Principal[] # may contain objects that represent unresolvable SIDs
if sid on_period UNK on_op on_tstring_beg on_tstring_content on_embexpr_beg on_ivar on_period UNK on_embexpr_end on_tstring_end on_period UNK on_nl return UNK unless on_lbracket # Examples of SidType include SidTypeUser, SidTypeGroup
return UNK unless on_lbracket on_symbeg on_const on_comma on_symbeg on_const on_rbracket on_period UNK on_lparen on_const on_op on_const on_op on_const on_op on_const # Check if we're getting back a local user when domain-joined
return sid on_period domain on_period UNK on_lparen on_const on_op on_const on_op on_const on_op on_const on_period UNK on_rparen on_op on_int on_nl # The resource domain and the computer name are not always case-matching
UNK on_op sid on_period UNK on_op on_symbeg on_const on_nl return UNK if sid on_period UNK on_op on_symbeg on_const on_op on_op # 'well known group' is special as it can be a group like Everyone OR a user like SYSTEM # so try to resolve it # https://msdn.microsoft.com/en-us/library/cc234477.aspx
UNK on_nl end on_nl on_ignored_nl def UNK on_nl raise on_const on_comma _ on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl end on_nl # special accounts like SYSTEM or special groups like Authenticated Users cannot # resolve via monikers like WinNT://./SYSTEM,user or WinNT://./Authenticated Users,group # -- they'll fail to connect. thus, given a validly resolved SID, this failure is # ambiguous as it may indicate either a group like Service or an account like SYSTEM
UNK on_op new on_lparen UNK on_period name on_rparen on_nl end on_nl on_ignored_nl UNK on_period each on_lparen on_op UNK on_rparen on_nl # Setting WIN32OLE.codepage in the microsoft_windows feature ensures # values are returned as UTF-8
native_object on_period on_const on_lparen UNK on_rparen on_nl end on_nl on_ignored_nl def on_op on_lparen UNK on_comma UNK on_rparen on_ignored_nl native_object on_period # Setting WIN32OLE.codepage ensures values are returned as UTF-8
if e on_period UNK on_op UNK on_tstring_content UNK on_nl raise on_const on_op on_const on_period new on_lparen on_ignored_nl _ on_lparen on_tstring_beg # ERROR_BAD_USERNAME 2202L from winerror.h
on_ivar on_op on_tstring_beg on_tstring_content on_tstring_end on_nl on_ignored_nl class on_op self on_nl def UNK on_nl on_const on_op on_const on_op on_const on_op # https://msdn.microsoft.com/en-us/library/aa746340.aspx # IADsUser interface
raise on_const on_op on_const on_period new on_lparen _ on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_op on_lbrace on_label name on_rbrace on_rparen if # Windows error 1379: The specified local group already exists.
UNK on_op on_lbracket on_rbracket on_nl native_object on_period on_const on_period each on_lbrace on_op UNK on_op UNK on_op UNK on_period on_const on_rbrace # https://msdn.microsoft.com/en-us/library/aa746342.aspx # WIN32OLE objects aren't enumerable, so no map
native_object on_period on_const on_period each on_lbrace on_op UNK on_op UNK on_op UNK on_period on_const on_rbrace rescue UNK on_nl UNK on_nl # Setting WIN32OLE.codepage ensures values are returned as UTF-8
def UNK on_lparen desired_groups on_comma UNK on_op UNK on_rparen on_ignored_nl return if desired_groups on_period UNK on_nl on_ignored_nl desired_groups on_op desired_groups # TODO: This code's pretty similar to set_members in the Group class. Would be nice # to refactor them into the ADSIObject class at some point. This was not done originally # because these use different methods to do stuff that are also aliased to other methods, # so the shared code isn't exactly a 1:1 mapping.
if on_op desired_groups on_period empty? on_nl UNK on_op on_lparen desired_hash on_period keys on_op current_hash on_period keys on_rparen on_period map on_lbrace # First we add the user to all the groups it should be in but isn't
if on_op UNK on_nl if desired_hash on_period empty? on_nl UNK on_op current_hash on_period UNK on_nl UNK on_ignored_nl UNK on_op on_lparen # Then we remove the user from all groups it is in but shouldn't be, if # that's been requested
on_const on_op on_lbrace on_ignored_nl on_label on_int on_comma on_ignored_nl on_label on_int on_comma on_ignored_nl on_label on_int on_comma on_ignored_nl on_label on_int on_comma on_ignored_nl # Declare all of the available user flags on the system. Note that # ADS_UF is read as ADS_UserFlag # https://docs.microsoft.com/en-us/windows/desktop/api/iads/ne-iads-ads_user_flag # and # https://support.microsoft.com/en-us/help/305144/how-to-use-the-useraccountcontrol-flags-to-manipulate-user-account-pro # for the flag values.
def UNK on_lparen on_op flags on_comma on_op UNK on_rparen on_ignored_nl return if flags on_period empty? on_nl on_ignored_nl UNK on_op flags # Common helper for set_userflags and unset_userflags. # # @api private
return if flags on_period empty? on_nl on_ignored_nl UNK on_op flags on_period UNK on_lbrace on_op flag on_op on_const on_period keys on_period # Avoid an unnecessary set + commit operation.
UNK on_lparen on_symbeg on_const on_rparen on_nl end on_nl on_ignored_nl def UNK on_nl UNK on_op native_object on_period on_const on_lparen on_tstring_beg on_tstring_content # Note that the LOCKOUT flag is known to be inaccurate when using the # LDAP IADsUser provider, but this class consistently uses the WinNT # provider, which is expected to be accurate.
raise e unless e on_period UNK on_op UNK on_tstring_content UNK on_nl UNK on_nl end on_nl on_ignored_nl on_const on_op on_int on_nl # This OLE error code indicates the property can't be found in the cache
on_const on_op on_int on_nl def self on_period UNK on_nl UNK on_op on_tstring_beg on_tstring_end on_nl max_length on_op on_const on_op on_int on_const # UNLEN from lmcons.h - https://stackoverflow.com/a/2155176
on_const on_op on_const on_period new on_lparen max_length on_op on_int on_rparen do on_op buffer on_op on_const on_op on_const on_period new on_lparen # NULL terminated
on_const on_op on_const on_period new on_lparen on_symbeg UNK on_comma on_int on_rparen do on_op buffer_size on_op on_ignored_nl buffer_size on_period UNK on_lparen # wide string
on_ignored_nl if on_const on_lparen buffer on_comma buffer_size on_rparen on_op on_const on_op on_const on_nl raise on_const on_op on_const on_op on_const on_op # length in TCHARs
UNK on_op buffer on_period UNK on_lparen buffer_size on_period UNK on_op on_int on_rparen on_nl end on_nl end on_nl on_ignored_nl UNK on_nl # buffer_size includes trailing NULL
UNK on_symbeg UNK on_nl UNK on_symbeg on_const on_comma on_ignored_nl on_lbracket on_symbeg UNK on_comma on_symbeg UNK on_rbracket on_comma on_symbeg UNK on_nl # https://msdn.microsoft.com/en-us/library/windows/desktop/ms724432(v=vs.85).aspx # BOOL WINAPI GetUserName( # _Out_ LPTSTR lpBuffer, # _Inout_ LPDWORD lpnSize # );
raise e unless e on_period UNK on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl on_ignored_nl on_const on_period UNK _ on_lparen # https://social.technet.microsoft.com/Forums/en/ITCG/thread/0f190051-ac96-4bf1-a47f-6b864bfacee5 # Prior to Vista SP1, there's no built-in way to programmatically # delete user profiles (except for delprof.exe). So try to delete # but warn if we fail
on_ivar on_op on_tstring_beg on_tstring_content on_tstring_end on_nl on_ignored_nl class on_op self on_nl def UNK on_nl on_const on_op on_const on_op on_const on_op # https://msdn.microsoft.com/en-us/library/aa706021.aspx # IADsGroup interface
raise on_const on_op on_const on_period new on_lparen _ on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_op on_lbrace on_label name on_rbrace on_rparen if # Windows error 2224: The account already exists.
def UNK on_nl self on_period class on_period UNK on_lparen native_object on_period on_const on_rparen on_nl end on_nl UNK UNK UNK on_nl # returns Puppet::Util::Windows::SID::Principal[] # may contain objects that represent unresolvable SIDs # qualified account names are returned by calling #domain_account
if on_op desired_hash on_period empty? on_nl UNK on_op on_lparen desired_hash on_period keys on_op current_hash on_period keys on_rparen on_period map on_lbrace # First we add all missing members
if UNK on_nl if desired_hash on_period empty? on_nl UNK on_op current_hash on_period UNK on_nl UNK on_ignored_nl UNK on_op on_lparen current_hash # Then we remove all extra members if inclusive
