raise on_const on_period new on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen if mode on_op on_op mode on_period UNK on_lparen on_const on_rparen on_nl # PUP-6959 mode is explicitly ignored until it can be implemented # Ruby on Windows uses mode for setting file attributes like read-only and # archived, not for setting permissions like POSIX
string_path on_op on_op on_const on_period UNK on_lparen path on_period UNK on_op nil on_op UNK on_lparen path on_rparen on_comma UNK on_rparen # ensure `nil` values behave like underlying File.expand_path
return string_path if on_op string_path on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl on_ignored_nl UNK on_ignored_nl string_path on_op on_const on_op # if no tildes, nothing to expand, no need to call Windows API, return original string
string_path on_op on_const on_op on_const on_op on_const on_op on_const on_period UNK on_lparen string_path on_rparen on_nl UNK on_const on_op on_const on_op # no need to do existence check up front as GetLongPathName implies that check is performed # and it should be the exception that files aren't actually present
raise if on_lparen e on_period UNK on_op on_const on_op on_const on_op on_const on_op on_const on_op on_const on_op on_ignored_nl e on_period # preserve original File.expand_path behavior for file / path not found by returning string
UNK on_op on_const on_op on_const on_op on_const on_op on_const on_period stat on_lparen dest on_rparen if UNK on_nl on_ignored_nl return on_int # returns false on dangling symlink
return on_int if UNK on_op UNK on_period UNK on_op on_tstring_beg on_tstring_content on_tstring_end on_nl on_ignored_nl if UNK on_op UNK on_period UNK # silent fail to preserve semantics of original FileUtils
on_const on_op on_const on_op on_const on_op on_const on_period UNK on_lparen path on_comma dest on_rparen on_nl end on_nl on_ignored_nl on_int on_nl # can only be file
stat on_op on_const on_op on_const on_op on_const on_op on_const on_period stat on_lparen file_name on_rparen UNK nil on_nl on_ignored_nl if on_op # handle PathName
if on_op stat on_nl on_op on_const on_period UNK on_lparen file_name on_rparen UNK on_const on_period UNK on_lparen file_name on_rparen on_nl UNK # sigh, Ruby + Windows :(
on_const on_op on_int on_nl on_const on_op on_int on_nl on_const on_op on_int on_nl on_const on_op on_int on_nl on_ignored_nl def UNK on_lparen # https://docs.microsoft.com/en-us/windows/desktop/debug/system-error-codes--0-499-
