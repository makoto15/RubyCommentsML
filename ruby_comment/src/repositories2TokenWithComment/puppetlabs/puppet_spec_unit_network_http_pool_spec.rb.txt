pool on_op on_const on_op on_const on_op on_const on_op on_const on_period new on_lparen on_op on_int on_rparen on_nl connections on_period UNK do # setting keepalive timeout to -1 ensures any newly added # connections have already expired
conn on_op create_connection on_lparen site on_rparen on_nl pool on_op create_pool on_nl pool on_period release on_lparen site on_comma verifier on_comma conn # we're not distinguishing between network errors that would # suggest we close the socket, and other errors
UNK on_const on_op on_const on_op on_const on_period UNK on_nl UNK on_op on_const on_op on_const on_period UNK on_lparen on_symbeg on_const on_comma # On windows, Socket.getsockopt() doesn't return exactly the same data # as an equivalent Socket::Option.new() statement, so we strip off the # unrelevant bits only on this platform. # # To make sure we're not voiding the test case by doing this, we check # both with and without the keepalive bit set. # # This workaround can be removed once all the ruby versions we care about # have the patch from https://bugs.ruby-lang.org/issues/11958 applied. #
expect on_lparen pool on_period borrow on_lparen site on_comma UNK on_rparen on_rparen on_period to eq on_lparen new_conn on_rparen on_nl end on_nl # 'equal' tests that it's the same object
UNK on_op on_const on_op on_const on_op on_const on_period new on_lparen site on_period UNK on_comma UNK on_rparen on_nl expect on_lparen pool # 'equal' tests that it's the same object
expect on_lparen pool on_period borrow on_lparen http_site on_comma nil on_rparen on_rparen on_period to UNK on_lparen old_conn on_rparen on_nl end on_nl # 'equal' tests that it's the same object
