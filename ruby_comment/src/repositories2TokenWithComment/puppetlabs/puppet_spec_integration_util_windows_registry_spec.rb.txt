UNK on_op on_lbracket on_int on_comma on_int on_rbracket on_nl on_const on_op on_const on_period UNK on_lparen UNK on_rparen do on_op UNK on_op # Normally DWORDs contain 4 bytes. This bad data only has 2
expect do on_ignored_nl subject on_period open on_lparen hkey on_comma on_tstring_beg on_tstring_content on_tstring_end on_rparen on_lbrace on_op hkey on_op on_rbrace on_nl end # file not found
on_ignored_nl hklm on_period open on_lparen puppet_key on_comma on_const on_op on_const on_op on_const on_op UNK on_rparen do on_op reg on_op on_ignored_nl # Ruby 2.1.5 has bugs with deleting registry keys due to using ANSI # character APIs, but passing wide strings to them (facepalm) # https://github.com/ruby/ruby/blob/v2_1_5/ext/win32/lib/win32/registry.rb#L323-L329 # therefore, use our own built-in registry helper code
it on_tstring_beg on_tstring_content on_tstring_end on_comma on_ignored_nl on_symbeg UNK on_op on_const on_op on_const on_op on_const on_period UNK do on_ignored_nl on_ignored_nl UNK # proof that local encodings (such as IBM437 are no longer relevant)
UNK on_op on_const on_op on_const on_nl UNK on_op UNK on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_period UNK on_lparen on_const # create a UTF-16LE byte array representing "–™"
UNK on_op on_const on_op on_const on_nl UNK on_op UNK on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_period UNK on_lparen on_const # and it's UTF-8 equivalent bytes
expect on_lparen on_const on_op on_const on_rparen on_period not_to receive on_lparen on_symbeg UNK on_rparen on_nl on_ignored_nl expect on_lparen on_const on_op on_const # this problematic Ruby codepath triggers a conversion of UTF-16LE to # a local codepage which can totally break when that codepage has no # conversion from the given UTF-16LE characters to local codepage # a prime example is that IBM437 has no conversion from a Unicode en-dash
expect on_lparen on_const on_op on_const on_rparen on_period not_to receive on_lparen on_symbeg UNK on_rparen on_nl expect on_lparen on_const on_op on_const on_rparen # also, expect that we're using our variants of keys / values, not Rubys
UNK on_op subject on_period UNK on_lparen reg on_rparen on_nl vals on_op subject on_period values on_lparen reg on_rparen on_nl on_ignored_nl expect # trigger Puppet::Util::Windows::Registry FFI calls
written on_op vals on_lbracket UNK on_rbracket on_nl expect on_lparen written on_rparen on_period to eq on_lparen UNK on_rparen on_nl expect on_lparen # The UTF-16LE string written should come back as the equivalent UTF-8
