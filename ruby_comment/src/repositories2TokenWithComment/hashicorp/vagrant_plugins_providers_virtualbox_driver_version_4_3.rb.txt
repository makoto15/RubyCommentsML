UNK on_const on_op on_const on_nl def UNK on_lparen uuid on_rparen on_ignored_nl UNK on_lparen on_rparen on_nl on_ignored_nl on_ivar on_op on_const on_op # Driver for VirtualBox 4.3.x
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_rparen on_op on_regexp_beg on_tstring_content on_regexp_end on_nl name on_op on_backref on_period to_s # Create the interface
ip on_op on_const on_period UNK on_lparen options on_lbracket on_symbeg UNK on_rbracket on_rparen on_nl on_ignored_nl if ip on_period UNK on_nl execute # Get the IP so we can determine v4 vs v6
if ip on_period UNK on_nl execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma name on_comma on_ignored_nl on_tstring_beg on_tstring_content # Configure
return on_lbrace on_ignored_nl on_label name on_comma on_ignored_nl on_label options on_lbracket on_symbeg UNK on_rbracket on_comma on_ignored_nl on_label options on_lbracket on_symbeg netmask # Return the details
last on_op on_int on_nl total on_op on_tstring_beg on_tstring_end on_nl UNK on_int if UNK on_nl on_ignored_nl execute on_lparen on_tstring_beg on_tstring_content on_tstring_end # Start with 0%
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma machine_id on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma snapshot_name on_rparen do on_op type on_comma data on_op # Snapshot and report the % progress
total on_op data on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_end on_rparen on_nl on_ignored_nl lines on_op total on_period split # Append the data so we can see the full view
lines on_op total on_period split on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl on_ignored_nl match on_op on_regexp_beg on_tstring_content on_regexp_end on_period match on_lparen # Break up the lines. We can't get the progress until we see an "OK"
match on_op on_regexp_beg on_tstring_content on_regexp_end on_period match on_lparen lines on_period last on_rparen on_nl if match on_nl current on_op match on_lbracket # The progress of the import will be in the last line. Do a greedy # regular expression to find what we're looking for.
last on_op on_int on_nl total on_op on_tstring_beg on_tstring_end on_nl UNK on_int if UNK on_nl on_ignored_nl execute on_lparen on_tstring_beg on_tstring_content on_tstring_end # Start with 0%
total on_op data on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_end on_rparen on_nl on_ignored_nl lines on_op total on_period split # Append the data so we can see the full view
lines on_op total on_period split on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl on_ignored_nl match on_op on_regexp_beg on_tstring_content on_regexp_end on_period match on_lparen # Break up the lines. We can't get the progress until we see an "OK"
match on_op on_regexp_beg on_tstring_content on_regexp_end on_period match on_lparen lines on_period last on_rparen on_nl if match on_nl current on_op match on_lbracket # The progress of the import will be in the last line. Do a greedy # regular expression to find what we're looking for.
end on_nl end on_nl end on_nl on_ignored_nl UNK on_period each do on_op name on_op on_ignored_nl UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end # VirtualBox could not find the vm. It may have been deleted # by another process after we called 'vboxmanage list vms'? Ignore this error.
UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma name on_rparen on_nl on_ignored_nl execute on_lparen # First try to remove any DHCP servers attached. We use `raw` because # it is okay if this fails. It usually means that a DHCP server was # never attached.
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma name on_rparen on_nl end on_nl end on_nl on_ignored_nl def UNK # Delete the actual host only network interface.
on_ivar on_period debug on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl output on_op execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end # Dry-run the import to get the suggested name and path
specified_name on_op on_tstring_beg on_embexpr_beg UNK on_embexpr_end on_tstring_content on_embexpr_beg on_lparen on_const on_period UNK on_period UNK on_op UNK on_rparen on_period to_i on_embexpr_end # Append millisecond plus a random to the path in case we're # importing the same box elsewhere.
UNK on_op on_lbracket on_ignored_nl on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma on_ignored_nl on_tstring_beg on_tstring_content on_tstring_end on_comma specified_name on_comma on_ignored_nl # Build the specified name param list
disk_params on_op on_lbracket on_rbracket on_nl UNK on_op output on_period UNK on_lparen on_regexp_beg on_tstring_content on_regexp_end on_rparen on_nl UNK on_period each do # Extract the disks list and build the disk target params
disk_params on_op path on_period reverse on_period UNK on_lparen on_tstring_beg on_tstring_content on_embexpr_beg UNK on_embexpr_end on_tstring_content on_tstring_end on_period reverse on_rparen on_lbrace on_tstring_beg # we use the block form of sub here to ensure that if the specified_name happens to end with a number (which is fairly likely) then # we won't end up having the character sequence of a \ followed by a number be interpreted as a back reference. For example, if # specified_name were "abc123", then "\\abc123\\".reverse would be "\\321cba\\", and the \3 would be treated as a back reference by the sub
UNK on_ignored_nl disk_params on_op path on_period reverse on_period UNK on_lparen on_tstring_beg on_tstring_content on_embexpr_beg UNK on_embexpr_end on_tstring_content on_tstring_end on_period reverse on_comma # Replace only last occurrence
end on_nl end on_nl on_ignored_nl execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma UNK on_comma on_op UNK on_comma on_op disk_params on_rparen do # Replace only last occurrence
output on_op data on_nl elsif type on_op on_symbeg stderr on_nl total on_op data on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma # Keep track of the stdout so that we can get the VM name
total on_op data on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_end on_rparen on_nl on_ignored_nl lines on_op total on_period split # Append the data so we can see the full view
lines on_op total on_period split on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl if lines on_period include? on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen # Break up the lines. We can't get the progress until we see an "OK"
match on_op on_regexp_beg on_tstring_content on_regexp_end on_period match on_lparen lines on_period last on_rparen on_nl if match on_nl current on_op match on_lbracket # The progress of the import will be in the last line. Do a greedy # regular expression to find what we're looking for.
UNK on_op on_backref on_period to_i if line on_op on_regexp_beg on_tstring_content on_regexp_end on_nl on_ignored_nl if UNK on_op line on_op on_regexp_beg on_tstring_content # This is how we find the nic that a FP is attached to, # since this comes first.
if UNK on_op line on_op on_regexp_beg on_tstring_content on_regexp_end on_op on_backref on_period to_s on_op on_tstring_beg on_tstring_content on_tstring_end on_nl return on_lbracket on_rbracket # If we care about active VMs only, then we check the state # to verify the VM is running.
if line on_op on_regexp_beg on_tstring_content on_regexp_end on_nl result on_op on_lbracket UNK on_comma on_backref on_period to_s on_comma on_backref on_period to_i on_comma # Parse out the forwarded port information
info on_nl end on_nl end on_nl on_ignored_nl def UNK on_nl execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma # Return the info to build up the results
UNK on_op on_backref on_period to_s on_nl return UNK on_period split on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_period UNK on_nl end on_nl # Split the version by _ since some distro versions modify it # to look like this: 4.1.2_ubuntu, and the distro part isn't # too important.
info on_op execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_ivar on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma on_label true on_rparen on_nl info on_period # If we can't get the guest additions version by guest property, try # to get it from the VM info itself.
UNK if uuid on_op on_ivar on_nl on_ignored_nl UNK on_ignored_nl UNK on_lparen uuid on_comma true on_rparen on_period each do on_op _ # Ignore our own used ports
end on_nl end on_nl end on_nl on_ignored_nl UNK on_nl end on_nl on_ignored_nl def UNK on_nl results on_op on_lbrace on_rbrace on_nl # VirtualBox could not find the vm. It may have been deleted # by another process after we called 'vboxmanage list vms'? Ignore this error.
raise on_const on_op on_const on_op on_const on_comma on_ignored_nl on_label e on_period extra_data on_lbracket on_symbeg stderr on_rbracket on_nl end on_nl on_ignored_nl # We got VERR_ALREADY_EXISTS. This means that we're renaming to # a VM name that already exists. Raise a custom error.
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_ivar on_comma on_tstring_beg on_tstring_content on_embexpr_beg folder on_lbracket on_symbeg name on_rbracket on_embexpr_end on_tstring_end on_comma on_tstring_beg # Enable symlinks on the shared folder
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma on_ivar on_comma on_op args on_rparen on_nl end on_nl end on_nl # Add the shared folder
UNK on_period each do on_op _ on_comma _ on_comma UNK on_comma UNK on_op on_ignored_nl return UNK if UNK on_op UNK # Look for the forwarded port only by comparing the guest port
return true on_nl end on_nl on_ignored_nl raise on_const on_op on_const on_op on_const on_comma on_ignored_nl on_label UNK on_period UNK on_comma on_ignored_nl # Some systems return an exit code 1 for some reason. For that # we depend on the output.
raise on_const on_op on_const on_op on_const on_comma on_ignored_nl on_label UNK on_period UNK on_comma on_ignored_nl on_label r on_period stderr on_nl end # If we reached this point then it didn't work out.
UNK on_ignored_nl raise on_nl end on_nl end on_nl end on_nl end on_nl on_ignored_nl def UNK on_nl execute on_lparen on_tstring_beg on_tstring_content # The folder doesn't exist. ignore.
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_comma on_label true on_rparen on_nl end on_nl on_ignored_nl def UNK on_lparen # This command sometimes fails if kernel drivers aren't properly loaded # so we just run the command and verify that it succeeded.
return UNK if result on_period stderr on_period include? on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl on_ignored_nl UNK on_int on_nl end on_nl # If vboxmanage returned VBOX_E_OBJECT_NOT_FOUND, # then the vm truly does not exist. Any other error might be transient
UNK on_int on_nl end on_nl on_ignored_nl execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma uuid on_rparen on_nl return true on_nl end on_nl # Sleep a bit though to give VirtualBox time to fix itself
execute on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma uuid on_rparen on_nl return true on_nl end on_nl on_ignored_nl UNK on_nl on_ignored_nl def UNK # If we reach this point, it means that we consistently got the # failure, do a standard vboxmanage now. This will raise an # exception if it fails again.
if ip on_op on_tstring_beg on_tstring_content on_tstring_end on_nl return UNK on_nl UNK on_ignored_nl return true on_nl end on_nl end on_nl end # Filter out invalid IP addresses # GH-4658 VirtualBox can report an IP address of 0.0.0.0 for FreeBSD guests.
