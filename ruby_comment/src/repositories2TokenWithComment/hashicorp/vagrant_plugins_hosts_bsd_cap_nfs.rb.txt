logger on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl dirmap on_op UNK UNK on_nl UNK on_period UNK UNK on_op UNK # We need to build up mapping of directories that are enclosed # within each other because the exports file has to have subdirectories # of an exported directory on the same line. e.g.: # # "/foo" "/foo/bar" ... # "/bar" # # We build up this mapping within the following hash.
dirs on_op hostpath on_nl UNK on_op UNK on_nl UNK on_nl end on_nl end on_nl on_ignored_nl UNK if UNK on_nl end # TODO: verify opts and diropts are _identical_, raise an error # if not. NFS mandates subdirectories have identical options.
dirmap on_period each do on_op dirs on_comma UNK on_op on_ignored_nl dirs on_period UNK on_nl dirs on_period UNK UNK on_op UNK # Sort all the keys by length so that the directory closest to # the root is exported first. Also, remove duplicates so that # checkexports will work properly.
dirmap on_period each do on_op dirs on_comma opts on_op on_ignored_nl if on_op opts on_lbracket on_symbeg UNK on_rbracket on_nl opts on_lbracket # Setup the NFS options
if UNK on_op UNK on_tstring_content UNK on_op UNK on_op UNK on_tstring_content UNK on_nl UNK on_op UNK on_nl UNK on_nl end # mapall/maproot are mutually exclusive, so we have to check # for both here.
UNK on_period info on_const on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl UNK UNK on_nl on_ignored_nl UNK on_lparen id on_rparen # The sleep ensures that the output is truly flushed before any `sudo` # commands are issued.
UNK on_lparen id on_rparen on_nl on_ignored_nl UNK on_op on_tstring_beg on_tstring_end on_nl UNK on_op on_tstring_beg on_tstring_content on_tstring_end if on_op on_const on_period # First, clean up the old entry
UNK on_op on_tstring_beg on_tstring_end on_nl UNK on_op on_tstring_beg on_tstring_content on_tstring_end if on_op on_const on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen # Only use "sudo" if we can't write to /etc/exports directly
UNK on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_period each do on_op line on_op on_ignored_nl line on_op on_const on_op on_const # Output the rendered template into the exports
UNK on_lparen on_op UNK on_rparen on_nl end on_nl on_ignored_nl def self on_period UNK on_lparen environment on_rparen on_ignored_nl on_tstring_beg on_tstring_content on_tstring_end # We run restart here instead of "update" just in case nfsd # is not starting
UNK on_period info on_const on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl UNK on_op UNK on_nl end on_nl on_ignored_nl logger # We want to warn the user but we only want to output once
id on_op id on_period UNK on_lparen on_tstring_beg on_tstring_content on_tstring_end on_comma on_tstring_beg on_tstring_content on_tstring_end on_rparen on_nl id on_op id on_period UNK # Escape sed-sensitive characters:
UNK on_lparen on_op UNK on_rparen on_nl end on_nl on_ignored_nl def self on_period UNK on_nl UNK on_op on_const on_op on_const on_op # Use sed to just strip out the block of code which was inserted # by Vagrant, and restart NFS.
